Description: fix DoS via duplicate IPs on unconfig directives
Origin: backport, http://pkgs.fedoraproject.org/cgit/rpms/ntp.git/tree/ntp-4.2.6p5-cve-2016-2516.patch
Bug: http://support.ntp.org/bin/view/Main/NtpBug3011

Index: ntp-4.2.6.p3+dfsg/ntpd/ntp_request.c
===================================================================
--- ntp-4.2.6.p3+dfsg.orig/ntpd/ntp_request.c	2016-06-01 12:27:58.191674630 -0400
+++ ntp-4.2.6.p3+dfsg/ntpd/ntp_request.c	2016-06-01 12:27:58.191674630 -0400
@@ -1629,11 +1629,12 @@
 			if (peer->flags & FLAG_CONFIG)
 				found = 1;
 		}
-		NTP_INSIST(found);
-		NTP_INSIST(peer);
+		if (found) {
+			NTP_INSIST(peer);
 
-		peer_clear(peer, "GONE");
-		unpeer(peer);
+			peer_clear(peer, "GONE");
+			unpeer(peer);
+		}
 
 		cp = (struct conf_unpeer *)
 			((char *)cp + INFO_ITEMSIZE(inpkt->mbz_itemsize));
