Backport of:

From 07a5b8141e354a998a52994c3c9cd547927e56ce Mon Sep 17 00:00:00 2001
From:  <jnperlin@hydra.localnet>
Date: Wed, 30 Sep 2015 20:15:13 +0200
Subject: [PATCH] [TALOS-CAN-0063] avoid buffer overrun in ntpq

---
 ChangeLog   | 1 +
 ntpq/ntpq.c | 7 ++++++-
 2 files changed, 7 insertions(+), 1 deletion(-)

Index: ntp-4.2.6.p3+dfsg/ntpq/ntpq.c
===================================================================
--- ntp-4.2.6.p3+dfsg.orig/ntpq/ntpq.c	2015-10-23 11:55:35.651979475 -0400
+++ ntp-4.2.6.p3+dfsg/ntpq/ntpq.c	2015-10-23 11:55:35.647979431 -0400
@@ -3355,12 +3355,17 @@
 			char bv[401];
 			int len;
 
+			/* TALOS-CAN-0063: avoid buffer overrun */
 			atoascii(name, MAXVARLEN, bn, sizeof(bn));
-			atoascii(value, MAXVARLEN, bv, sizeof(bv));
 			if (output_raw != '*') {
+				atoascii(value, MAXVALLEN,
+					 bv, sizeof(bv) - 1);
 				len = strlen(bv);
 				bv[len] = output_raw;
 				bv[len+1] = '\0';
+			} else {
+				atoascii(value, MAXVALLEN,
+					 bv, sizeof(bv));
 			}
 			output(fp, bn, bv);
 		}
