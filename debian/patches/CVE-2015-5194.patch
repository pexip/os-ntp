Backport of:

From 553f2fa65865c31c5e3c48812cfd46176cffdd27 Mon Sep 17 00:00:00 2001
From:  <davehart@shiny.ad.hartbrothers.com>
Date: Wed, 28 Jul 2010 05:33:53 +0000
Subject: [PATCH] [Bug 1593] ntpd abort in free() with logconfig syntax error.

---
 ChangeLog         |   1 +
 ntpd/ntp_parser.c | 114 +++++++++++++++++++++++++++++-------------------------
 ntpd/ntp_parser.y |  24 ++++++++----
 3 files changed, 80 insertions(+), 59 deletions(-)

Index: ntp-4.2.6.p5+dfsg/ntpd/ntp_parser.y
===================================================================
--- ntp-4.2.6.p5+dfsg.orig/ntpd/ntp_parser.y	2015-10-22 15:04:36.368602522 -0400
+++ ntp-4.2.6.p5+dfsg/ntpd/ntp_parser.y	2015-10-22 15:04:36.368602522 -0400
@@ -1037,14 +1037,24 @@
 log_config_command
 	:	T_String
 		{
-			char prefix = $1[0];
-			char *type = $1 + 1;
+			char	prefix;
+			char *	type;
 			
-			if (prefix != '+' && prefix != '-' && prefix != '=') {
-				yyerror("Logconfig prefix is not '+', '-' or '='\n");
-			}
-			else
-				$$ = create_attr_sval(prefix, estrdup(type));
+			switch ($1[0]) {
+			
+			case '+':
+			case '-':
+			case '=':
+				prefix = $1[0];
+				type = $1 + 1;
+				break;
+				
+			default:
+				prefix = '=';
+				type = $1;
+			}	
+			
+			$$ = create_attr_sval(prefix, estrdup(type));
 			YYFREE($1);
 		}
 	;
