Backport of:

From 52e977d79a0c4ace997e5c74af429844da2f27be Mon Sep 17 00:00:00 2001
From:  <davehart@shiny.ad.hartbrothers.com>
Date: Thu, 6 Jan 2011 04:02:24 +0000
Subject: [PATCH] [Bug 1773] openssl not detected during ./configure. [Bug
 1774] Segfaults if cryptostats enabled and built without OpenSSL.

---
 ChangeLog         |  2 ++
 m4/ntp_openssl.m4 | 38 ++++++++++++++++----------------------
 ntpd/ntp_config.c | 12 ++++++++++++
 ntpd/ntp_util.c   | 12 ++----------
 4 files changed, 32 insertions(+), 32 deletions(-)

Index: ntp-4.2.6.p3+dfsg/ntpd/ntp_config.c
===================================================================
--- ntp-4.2.6.p3+dfsg.orig/ntpd/ntp_config.c	2015-10-23 11:54:13.283080251 -0400
+++ ntp-4.2.6.p3+dfsg/ntpd/ntp_config.c	2015-10-23 11:54:13.279080207 -0400
@@ -2014,6 +2014,13 @@
 	while (pfilegen_token != NULL) {
 		filegen_string = keyword(*pfilegen_token);
 		filegen = filegen_get(filegen_string);
+		if (NULL == filegen) {
+			msyslog(LOG_ERR,
+				"stats %s unrecognized",
+				filegen_string);
+			pfilegen_token = next_node(pfilegen_token);
+			continue;
+		}
 
 		DPRINTF(4, ("enabling filegen for %s statistics '%s%s'\n",
 			    filegen_string, filegen->prefix, 
@@ -2027,6 +2034,13 @@
 	while (my_node != NULL) {
 		filegen_file = keyword(my_node->filegen_token);
 		filegen = filegen_get(filegen_file);
+		if (NULL == filegen) {
+			msyslog(LOG_ERR,
+				"filegen category '%s' unrecognized",
+				filegen_file);
+			my_node = next_node(my_node);
+			continue;
+		}
 
 		/* Initialize the filegen variables to their pre-configurtion states */
 		filegen_flag = filegen->flag;
